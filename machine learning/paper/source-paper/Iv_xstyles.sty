%%==============================================================================
%%      LaTeX second version styles file
%%
%%      Sergey Ivanychev
%%
%%      v2.7
%%
%%
%%      Changelog v2.2
%%      -- added specific math symbols and operators
%%      -- fixed citation
%%
%%      Changelog v2.1
%%      -- added english templates and \ivensign command
%%
%%      Changelog v2.2
%%      -- added XeLaTeX support
%%
%%      Changelog v2.4
%%      -- added \geometry package for simpler setting
%%      -- removed ancient TeX page parameters
%%      -- added \emergencystretch to fight overfull
%%      -- fixed hyphenation (added babel and csquotes packages)
%%      -- there is no new page with \maketitle if you use \ivtitle
%%
%%      Changelog v2.5
%%      -- added custom theorem, remark, definition and proof styles
%%
%%      Changelog v2.6
%%      -- added more efficient \newcommands
%%      -- added FAQ section
%%
%%      Changelob v2.7
%%      -- moved commands and theorem definitions to separate file
%%      -- minor improvements
%%
%%
%%      (CC)
%%
%%==============================================================================

%%=== Geometry =================================================================

\usepackage{geometry}
\geometry{
 a4paper,
 total={165mm,240mm},
 left=20mm,
 top=18mm,
 }
\setlength{\parskip}{0.2cm}

 \emergencystretch 10pt


\usepackage{amsmath, amsthm, amssymb}
% \usepackage{fourier}
% \usepackage{fouriernc}
% \usepackage{pxfonts}
% \usepackage[math]{kurier}
% \usepackage[garamond]{mathdesign}
% \usepackage[charter]{mathdesign}
% \usepackage[utopia]{mathdesign}
% \usepackage{mathpazo}
% \usepackage{mathptmx}
\usepackage{microtype}
\SetProtrusion{encoding={*},family={bch},series={*},size={6,7}}
              {1={ ,750},2={ ,500},3={ ,500},4={ ,500},5={ ,500},
               6={ ,500},7={ ,600},8={ ,500},9={ ,500},0={ ,500}}
% \usepackage[version=3]{mhchem}


\usepackage[cm-default]{fontspec}
\usepackage{xunicode}
% to allow custom headings
\usepackage{titlesec}
% to change titles font family
\usepackage{titling}
\usepackage[russian]{babel}
% \usepackage{xltxtra}
\defaultfontfeatures{Ligatures = TeX}
\setromanfont{Garamond Premier Pro}
\setsansfont{Open Sans}
\setmonofont[Color={0019D4}]{Inconsolata LGC}
\newfontfamily\subheadingfont[]{Garamond Premier Pro Medium Subhead}
\newfontfamily\headingfont[]{Garamond Premier Pro Medium Display}
\titleformat*{\section}{\LARGE\subheadingfont}
\titleformat*{\subsection}{\Large\subheadingfont}
\renewcommand{\maketitlehooka}{\headingfont}

%% Works fine (Example)
% \usepackage{fontspec}
% \setmainfont[
% BoldFont=timesbd.ttf,
% ItalicFont=timesi.ttf,
% BoldItalicFont=timesbi.ttf
% ]{times.ttf}
%%

%\usepackage{natbib}   % omit 'round' option if you prefer square brackets
%\bibliographystyle{plainnat}
\usepackage[bibstyle=authortitle, backend=biber, style=numeric]{biblatex}


%%=== Extra packages ===========================================================

% Enables \wrapfigure and \wraptable
\usepackage{wrapfig}

% Enchancing font and adds glyphs to default LaTeX font (?)
% \usepackage{lmodern}

% Make the first line of all sections etc., be indented by the usual paragraph
% indentation.
\usepackage{indentfirst}

% Inserting source code without any dirty job
\usepackage{verbatim}

% Drawing automatas and other math diagrams and figures
% \usepackage{tikz}
%\usetikzlibrary{automata,positioning}

% Enables \includegraphics to use pictures in creating document
\usepackage{graphicx}
\usepackage{caption}
\usepackage{subcaption}

\usepackage{lipsum}

% Enables import from .csv
% \usepackage{csvsimple}

% Using indentation for links
\usepackage[colorlinks, urlcolor=blue]{hyperref}
\hypersetup{colorlinks=true,citecolor=blue}

% Footnotes
\usepackage[stable]{footmisc}

% Additional greek symbols
% \upal­pha, \up­beta, etc
\usepackage{upgreek}

% Citation
\usepackage{csquotes}


\usepackage{epigraph}

% Красная строка
\parindent = 0em



\newtheoremstyle{ivthm_style} % name
  {.5\baselineskip\@plus.2\baselineskip\@minus.2\baselineskip}% Space above
  {.5\baselineskip\@plus.2\baselineskip\@minus.2\baselineskip}% Space below
  {\slshape}                  % Body font
  {}                          % Indent amount (empty = no indent, \parindent = para indent)
  {\bfseries}                 % Thm head font
  {.}                         % Punctuation after thm head
  {\newline}                  % Space after thm head: " " = normal interword space;
                              % \newline = linebreak
  {}                          % Thm head spec

\newtheoremstyle{ivdef_style}%
  {.5\baselineskip\@plus.2\baselineskip\@minus.2\baselineskip}
  {.5\baselineskip\@plus.2\baselineskip\@minus.2\baselineskip}
  {}
  {}
  {\bfseries}
  {.}
  {\newline}
  {}

\newtheoremstyle{ivrem_style}%
  {.5\baselineskip\@plus.2\baselineskip\@minus.2\baselineskip}
  {.5\baselineskip\@plus.2\baselineskip\@minus.2\baselineskip}
  {}
  {}
  {\slshape}
  {.}
  {\newline}
  {}

\theoremstyle{ivthm_style}
\newtheorem{thm}{Теорема}[section]
\newtheorem{lem}{Лемма}[section]

\theoremstyle{ivrem_style}
\newtheorem{rem}{Ремарка}[section]

\theoremstyle{ivdef_style}
\newtheorem{df}{Определение}[section]

\newcommand*{\myproofname}{$\square$}
\newenvironment{ivproof}[1][\myproofname]{\begin{proof}[#1\nopunct]
\renewcommand*{\qedsymbol}{\(\blacksquare\)}}{\end{proof}}


\renewcommand{\colon}{\nobreak\mskip2mu\mathpunct{}\nonscript
  \mkern-\thinmuskip{:}\mskip6muplus1mu\relax}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Fixes a bug in the most recent TeX Live 2015
\NewBibliographyString{langjapanese}
\NewBibliographyString{fromjapanese}

%%=== FAQ ======================================================================
%%
%% \mathring{X_k} -- circle above math symbol
%% \xrightarrow[world]{hello} -- hello is above, world is below
%% \xRightarrow[world]{hello}
%%
%% \overbrace{...}^{подпись}
%% \underbrace{...}_{подпись}








%==============================================================================
% IF ONLY LATEX
%==============================================================================
% \usepackage[utf8]{inputenx}
% \DeclareUnicodeCharacter{00A0}{ }
% \DeclareUnicodeCharacter{00A0}{~}
%
%==============================================================================
% English-Russian
%==============================================================================
%
% Sets language family of used font (russian included)
% \usepackage[T2A, T1]{fontenc}
%
% Enables language-styled hyphenation
% \usepackage[english,russian]{babel}

%==============================================================================
% English only
%==============================================================================
%
% Sets language family of used font (only english)
% \usepackage[english]{babel}
%
% Garamond font (my favourite) (only english)
% \usepackage[cmintegrals,cmbraces]{newtxmath}
% \usepackage{ebgaramond-maths}
% \usepackage[T1]{fontenc}
%
%
%
% \makeatletter
%   \DeclareSymbolFont{ntxletters}{OML}{ntxmi}{m}{it}
%   \SetSymbolFont{ntxletters}{bold}{OML}{ntxmi}{b}{it}
%   \re@DeclareMathSymbol{\leftharpoonup}{\mathrel}{ntxletters}{"28}
%   \re@DeclareMathSymbol{\leftharpoondown}{\mathrel}{ntxletters}{"29}
%   \re@DeclareMathSymbol{\rightharpoonup}{\mathrel}{ntxletters}{"2A}
%   \re@DeclareMathSymbol{\rightharpoondown}{\mathrel}{ntxletters}{"2B}
%   \re@DeclareMathSymbol{\triangleleft}{\mathbin}{ntxletters}{"2F}
%   \re@DeclareMathSymbol{\triangleright}{\mathbin}{ntxletters}{"2E}
%   \re@DeclareMathSymbol{\partial}{\mathord}{ntxletters}{"40}
%   \re@DeclareMathSymbol{\flat}{\mathord}{ntxletters}{"5B}
%   \re@DeclareMathSymbol{\natural}{\mathord}{ntxletters}{"5C}
%   \re@DeclareMathSymbol{\star}{\mathbin}{ntxletters}{"3F}
%   \re@DeclareMathSymbol{\smile}{\mathrel}{ntxletters}{"5E}
%   \re@DeclareMathSymbol{\frown}{\mathrel}{ntxletters}{"5F}
%   \re@DeclareMathSymbol{\sharp}{\mathord}{ntxletters}{"5D}
%   \re@DeclareMathAccent{\vec}{\mathord}{ntxletters}{"7E}
% \makeatother


%%=== XeLaTeX===================================================================

